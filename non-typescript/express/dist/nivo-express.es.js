import t from"lodash/forOwn";import{Router as r}from"express";import*as o from"uuid";import{samples as s,chartsMapping as a,renderChart as n}from"@nivo/static";import e from"lodash/omit";var i={},u=r();u.get("/",(function(t,r){r.status(200).json({samples:Object.keys(s).map((function(r){return t.protocol+"://"+t.get("host")+t.originalUrl+"/samples/"+r+".svg"}))})})),t(a,(function(t,r){var s=t.schema;u.post("/charts/"+r,function(t,r){void 0===r&&(r={});var o=r.omit;return function(r,s,a){var n=r.body;e&&(n=e(n,o));try{r.payload=t.validate(n,{abortEarly:!0,convert:!0}),a()}catch(t){return s.status(400).json({errors:t.details.map((function(t){var r=t.message,o=t.path;return r+(o?" ("+o+")":"")}))})}}}(s),(function(t,s){var a,n=t.payload,e=o.v4(),u=t.protocol+"://"+t.get("host")+"/r/"+e;a={type:r,props:n,url:u},i[e]=a,s.status(201).json({id:e,url:u})}))})),u.get("/r/:id",(function(t,r){var o,s=t.params.id,a=(o=t.params.id,i[o]);if(!a)return r.set("Content-Type","text/plain").status(404).send('no chart found for id "'+s+'"');var e=n(a,t.query);r.set("Content-Type","image/svg+xml").status(200).send(e)})),t(s,(function(t,r){u.get("/samples/"+r+".svg",(function(r,o){var s=n(t,r.query);o.set("Content-Type","image/svg+xml").status(200).send(s)}))}));export{u as nivo};
//# sourceMappingURL=nivo-express.es.js.map
