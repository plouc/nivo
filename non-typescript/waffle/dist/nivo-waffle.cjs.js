"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("lodash/partial"),o=require("react-motion"),r=require("@nivo/recompose"),i=require("@nivo/core"),n=require("@nivo/legends"),a=require("prop-types"),l=require("@nivo/colors"),u=require("react/jsx-runtime"),d=require("lodash/range"),s=require("@nivo/tooltip");function f(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=f(t),p=f(a),h=f(d);function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},m.apply(this,arguments)}function v(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,y(e,t)}function y(e,t){return y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},y(e,t)}var g=function(e){var t=e.position,o=e.size,r=e.x,i=e.y,n=e.color,a=e.fill,l=e.opacity,d=e.borderWidth,s=e.borderColor,f=e.data,c=e.onHover,p=e.onLeave,h=e.onClick;return u.jsx("rect",{width:o,height:o,x:r,y:i,fill:a||n,strokeWidth:d,stroke:s,opacity:l,onMouseEnter:c,onMouseMove:c,onMouseLeave:p,onClick:function(e){h({position:t,color:n,x:r,y:i,data:f},e)}})};g.propTypes={position:p.default.number.isRequired,size:p.default.number.isRequired,x:p.default.number.isRequired,y:p.default.number.isRequired,color:p.default.string.isRequired,fill:p.default.string,opacity:p.default.number.isRequired,borderWidth:p.default.number.isRequired,borderColor:p.default.string.isRequired,data:p.default.object.isRequired,onHover:p.default.func.isRequired,onLeave:p.default.func.isRequired,onClick:p.default.func.isRequired},g.defaultProps={data:{}},g.displayName="WaffleCell";var C=r.pure(g),x=function(e){var t=e.position,o=e.size,r=e.x,i=e.y,n=e.color,a=e.opacity,l=e.borderWidth,d=e.borderColor,s=e.data,f=e.onHover,c=e.onLeave,p=e.onClick;return u.jsx("div",{style:{position:"absolute",top:i,left:r,width:o,height:o,background:n,opacity:a,boxSizing:"content-box",borderStyle:"solid",borderWidth:l+"px",borderColor:d},onMouseEnter:f,onMouseMove:f,onMouseLeave:c,onClick:function(e){p({position:t,color:n,x:r,y:i,data:s},e)}})};x.propTypes={position:p.default.number.isRequired,size:p.default.number.isRequired,x:p.default.number.isRequired,y:p.default.number.isRequired,color:p.default.string.isRequired,opacity:p.default.number.isRequired,borderWidth:p.default.number.isRequired,borderColor:p.default.string.isRequired,data:p.default.object.isRequired,onHover:p.default.func.isRequired,onLeave:p.default.func.isRequired,onClick:p.default.func.isRequired},x.defaultProps={data:{}},x.displayName="WaffleCellHtml";var b=r.pure(x),R={total:p.default.number.isRequired,data:p.default.arrayOf(p.default.shape({id:p.default.oneOfType([p.default.string,p.default.number]).isRequired,label:p.default.oneOfType([p.default.string,p.default.number]).isRequired,value:p.default.number.isRequired})).isRequired,hiddenIds:p.default.arrayOf(p.default.oneOfType([p.default.string,p.default.number])).isRequired,rows:p.default.number.isRequired,columns:p.default.number.isRequired,fillDirection:p.default.oneOf(["top","right","bottom","left"]).isRequired,padding:p.default.number.isRequired,colors:l.ordinalColorsPropType.isRequired,emptyColor:p.default.string.isRequired,emptyOpacity:p.default.number.isRequired,borderWidth:p.default.number.isRequired,borderColor:l.inheritedColorPropType.isRequired,getBorderColor:p.default.func.isRequired,isInteractive:p.default.bool,tooltipFormat:p.default.oneOfType([p.default.func,p.default.string]),tooltip:p.default.func,cellSize:p.default.number.isRequired,cells:p.default.array.isRequired,origin:p.default.shape({x:p.default.number.isRequired,y:p.default.number.isRequired}).isRequired},q=m({},R,{cellComponent:p.default.func.isRequired,role:p.default.string.isRequired},i.defsPropTypes,{legends:p.default.arrayOf(p.default.shape(n.LegendPropShape)).isRequired}),w=m({},R,{cellComponent:p.default.func.isRequired}),W=m({},R,{pixelRatio:p.default.number.isRequired,legends:p.default.arrayOf(p.default.shape(n.LegendPropShape)).isRequired}),j={hiddenIds:[],fillDirection:"bottom",padding:1,colors:{scheme:"nivo"},emptyColor:"#cccccc",emptyOpacity:1,borderWidth:0,borderColor:{from:"color",modifiers:[["darker",1]]},defs:[],fill:[],isInteractive:!0,onClick:i.noop},k=m({},j,{cellComponent:C,role:"img",defs:[],fill:[],legends:[]}),P=m({},j,{cellComponent:b}),D=m({},j,{legends:[],pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1}),T=Object.freeze({__proto__:null,WafflePropTypes:q,WaffleHtmlPropTypes:w,WaffleCanvasPropTypes:W,WaffleDefaultProps:k,WaffleHtmlDefaultProps:P,WaffleCanvasDefaultProps:D}),O=function(e,t,o,r,i,n){var a=function(e,t,o,r,i){var n=(e-(r-1)*i)/r,a=(t-(o-1)*i)/o;return Math.min(n,a)}(e,t,o,r,n),l=[];switch(i){case"top":h.default(o).forEach((function(e){h.default(r).forEach((function(t){l.push({position:e*r+t,row:e,column:t,x:t*(a+n),y:e*(a+n)})}))}));break;case"bottom":h.default(o-1,-1).forEach((function(e){h.default(r).forEach((function(t){l.push({position:e*r+t,row:e,column:t,x:t*(a+n),y:e*(a+n)})}))}));break;case"left":h.default(r).forEach((function(e){h.default(o).forEach((function(t){l.push({position:t*r+e,row:t,column:e,x:e*(a+n),y:t*(a+n)})}))}));break;case"right":h.default(r-1,-1).forEach((function(e){h.default(o-1,-1).forEach((function(t){l.push({position:t*r+e,row:t,column:e,x:e*(a+n),y:t*(a+n)})}))}));break;default:throw new Error("Invalid fill direction provided: "+i)}return{cells:l,cellSize:a,origin:{x:(e-(a*r+n*(r-1)))/2,y:(t-(a*o+n*(o-1)))/2}}},H=function(e,t){var o=e.map((function(e){return m({},e)}));return t.forEach((function(e){h.default(e.startAt,e.endAt).forEach((function(t){var r=o[t];void 0!==r&&(r.data=e,r.groupIndex=e.groupIndex,r.color=e.color)}))})),o},M=[i.withDimensions(),i.withTheme(),i.withMotion(),r.withPropsOnChange(["colors"],(function(e){var t=e.colors;return{getColor:l.getOrdinalColorScale(t,"id")}})),r.withPropsOnChange(["borderColor","theme"],(function(e){var t=e.borderColor,o=e.theme;return{getBorderColor:l.getInheritedColorGenerator(t,o)}})),r.withState("currentCell","setCurrentCell",null),r.withPropsOnChange(["rows","columns","total"],(function(e){var t=e.rows,o=e.columns;return{unit:e.total/(t*o)}})),r.withPropsOnChange(["width","height","rows","columns","fillDirection","padding"],(function(e){var t=e.width,o=e.height,r=e.rows,i=e.columns,n=e.fillDirection,a=e.padding;return O(t,o,r,i,n,a)})),r.withPropsOnChange(["data","unit","getColor","hiddenIds"],(function(e){var t=e.data,o=e.unit,r=e.getColor,i=e.hiddenIds,n=0;return{computedData:t.map((function(e,t){if(!i.includes(e.id)){var a=m({},e,{groupIndex:t,startAt:n,endAt:n+Math.round(e.value/o),color:r(e)});return n=a.endAt,a}return m({},e,{groupIndex:t,startAt:n,endAt:n,color:r(e)})}))}})),r.withPropsOnChange(["computedData"],(function(e){return{legendData:e.computedData.map((function(e){return{id:e.id,label:e.id,color:e.color,fill:e.fill}}))}}))],A=function(e){var t=T[e.displayName+"DefaultProps"];switch(e.displayName){case"Waffle":return r.compose.apply(void 0,[r.defaultProps(t)].concat(M,[i.withMotion(),r.withPropsOnChange(["computedData","defs","fill"],(function(e){var t=e.computedData,o=e.defs,r=e.fill;return{defs:i.bindDefs(o,t,r,{targetKey:"fill"})}})),r.pure]))(e);case"WaffleHtml":return r.compose.apply(void 0,[r.defaultProps(t)].concat(M,[i.withMotion(),r.pure]))(e);case"WaffleCanvas":return r.compose.apply(void 0,[r.defaultProps(t)].concat(M,[r.pure]))(e)}return e},E=function(e){var t=e.position,o=e.row,r=e.column,i=e.color,n=e.data,a=e.theme,l=e.tooltipFormat,d=e.tooltip;return u.jsx(s.BasicTooltip,{id:n.label,value:n.value,enableChip:!0,color:i,theme:a,format:l,renderContent:"function"==typeof d?d.bind(null,m({position:t,row:o,column:r,color:i},n)):null})};E.displayName="WaffleCellTooltip",E.propTypes={position:p.default.number.isRequired,row:p.default.number.isRequired,column:p.default.number.isRequired,color:p.default.string.isRequired,data:p.default.object.isRequired,theme:p.default.object.isRequired,tooltipFormat:p.default.oneOfType([p.default.func,p.default.string]),tooltip:p.default.func};var I=function(t){function r(){for(var e,o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).handleCellHover=function(t,o,r){var i=e.props,n=i.setCurrentCell,a=i.theme,l=i.tooltipFormat,d=i.tooltip;n(o),o.data&&t(u.jsx(E,{position:o.position,row:o.row,column:o.column,color:o.color,data:o.data,theme:a,tooltipFormat:l,tooltip:d}),r)},e.handleCellLeave=function(t){e.props.setCurrentCell(null),t()},e}return v(r,t),r.prototype.render=function(){var t=this,r=this.props;r.hiddenIds;var a=r.margin,l=r.width,d=r.height,s=r.outerWidth,f=r.outerHeight,p=r.cellComponent,h=r.emptyColor,v=r.emptyOpacity,y=r.borderWidth,g=r.getBorderColor,C=r.theme,x=r.defs,b=r.animate,R=r.motionStiffness,q=r.motionDamping,w=r.isInteractive,W=r.onClick,j=r.cells,k=r.cellSize,P=r.origin,D=r.computedData,T=r.legendData,O=r.legends,M=r.role;return j.forEach((function(e){e.color=h})),u.jsx(i.LegacyContainer,{isInteractive:w,theme:C,animate:b,motionDamping:q,motionStiffness:R,children:function(r){var h,w=r.showTooltip,A=r.hideTooltip,E=c.default(t.handleCellHover,w),I=c.default(t.handleCellLeave,A);if(!0===b){var L={stiffness:R,damping:q};h=u.jsx(o.TransitionMotion,{styles:D.map((function(e){return{key:e.id,data:e,style:{startAt:o.spring(e.startAt,L),endAt:o.spring(e.endAt,L)}}})),children:function(t){var o=H(j,t.map((function(e){return m({},e.data,{startAt:Math.round(e.style.startAt),endAt:Math.round(e.style.endAt)})})));return u.jsx(e.Fragment,{children:o.map((function(t){return e.createElement(p,{key:t.position,position:t.position,size:k,x:t.x,y:t.y,color:t.color,fill:t.data&&t.data.fill,opacity:t.data?1:v,borderWidth:y,borderColor:g(t),data:t.data,onHover:c.default(E,t),onLeave:I,onClick:W})}))})}})}else{var S=H(j,D);h=u.jsx(e.Fragment,{children:S.map((function(t){return e.createElement(p,{key:t.position,position:t.position,size:k,x:t.x,y:t.y,color:t.color,fill:t.data&&t.data.fill,opacity:t.data?1:v,borderWidth:y,borderColor:g(t),data:t.data,onHover:c.default(E,t),onLeave:I,onClick:W})}))})}return u.jsxs(i.SvgWrapper,{width:s,height:f,margin:a,defs:x,theme:C,role:M,children:[u.jsx("g",{transform:"translate("+P.x+", "+P.y+")",children:h}),O.map((function(e,t){return u.jsx(n.BoxLegendSvg,m({},e,{containerWidth:l,containerHeight:d,data:T,theme:C}),t)}))]})}})},r}(e.Component);I.propTypes=q,I.displayName="Waffle";var L=r.setDisplayName(I.displayName)(A(I)),S=function(t){function r(){for(var e,o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).handleCellHover=function(t,o,r){var i=e.props,n=i.setCurrentCell,a=i.theme,l=i.tooltipFormat,d=i.tooltip;n(o),o.data&&t(u.jsx(E,{position:o.position,row:o.row,column:o.column,color:o.color,data:o.data,theme:a,tooltipFormat:l,tooltip:d}),r)},e.handleCellLeave=function(t){e.props.setCurrentCell(null),t()},e}return v(r,t),r.prototype.render=function(){var t=this,r=this.props,n=r.margin,a=r.outerWidth,l=r.outerHeight,d=r.cellComponent,s=r.emptyColor,f=r.emptyOpacity,p=r.borderWidth,h=r.getBorderColor,v=r.theme,y=r.animate,g=r.motionStiffness,C=r.motionDamping,x=r.isInteractive,b=r.onClick,R=r.cells,q=r.cellSize,w=r.origin,W=r.computedData;return R.forEach((function(e){e.color=s})),u.jsx(i.LegacyContainer,{isInteractive:x,theme:v,animate:y,motionDamping:C,motionStiffness:g,children:function(r){var i,s=r.showTooltip,v=r.hideTooltip,x=c.default(t.handleCellHover,s),j=c.default(t.handleCellLeave,v);if(!0===y){var k={stiffness:g,damping:C};i=u.jsx(o.TransitionMotion,{styles:W.map((function(e){return{key:e.id,data:e,style:{startAt:o.spring(e.startAt,k),endAt:o.spring(e.endAt,k)}}})),children:function(t){var o=H(R,t.map((function(e){return m({},e.data,{startAt:Math.round(e.style.startAt),endAt:Math.round(e.style.endAt)})})));return u.jsx(e.Fragment,{children:o.map((function(t){return e.createElement(d,{key:t.position,position:t.position,size:q,x:t.x,y:t.y,color:t.color,fill:t.data&&t.data.fill,opacity:t.data?1:f,borderWidth:p,borderColor:h(t),data:t.data,onHover:c.default(x,t),onLeave:j,onClick:b})}))})}})}else{var P=H(R,W);i=u.jsx(e.Fragment,{children:P.map((function(t){return e.createElement(d,{key:t.position,position:t.position,size:q,x:t.x,y:t.y,color:t.color,fill:t.data&&t.data.fill,opacity:t.data?1:f,borderWidth:p,borderColor:h(t),data:t.data,onHover:c.default(x,t),onLeave:j,onClick:b})}))})}return u.jsx("div",{style:{position:"relative",width:a,height:l},children:u.jsx("div",{style:{position:"absolute",top:n.top+w.y,left:n.left+w.x},children:i})})}})},r}(e.Component);S.propTypes=w,S.displayName="WaffleHtml";var z=r.setDisplayName(S.displayName)(A(S)),N=function(e,t,o,r,n,a){return e.find((function(e){return i.isCursorInRect(e.x+o.x+r.left,e.y+o.y+r.top,t,t,n,a)}))},F=function(e){function t(){for(var t,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(t=e.call.apply(e,[this].concat(r))||this).handleMouseHover=function(e,o){return function(r){var n=t.props,a=n.isInteractive,l=n.margin,d=n.theme,s=n.cells,f=n.cellSize,c=n.origin,p=n.tooltipFormat,h=n.tooltip;if(a&&s){var m=i.getRelativeCursor(t.surface,r),v=m[0],y=m[1],g=N(s,f,c,l,v,y);void 0!==g&&g.data?e(u.jsx(E,{position:g.position,row:g.row,column:g.column,color:g.color,data:g.data,theme:d,tooltipFormat:p,tooltip:h}),r):o()}}},t.handleMouseLeave=function(e){return function(){!0===t.props.isInteractive&&e()}},t.handleClick=function(e){var o=t.props,r=o.isInteractive,n=o.margin,a=o.onClick,l=o.cells,u=o.cellSize,d=o.origin;if(r&&l){var s=i.getRelativeCursor(t.surface,e),f=s[0],c=s[1],p=N(l,u,d,n,f,c);void 0!==p&&a(p,e)}},t}v(t,e);var o=t.prototype;return o.componentDidMount=function(){this.ctx=this.surface.getContext("2d"),this.draw(this.props)},o.componentDidUpdate=function(){this.ctx=this.surface.getContext("2d"),this.draw(this.props)},o.draw=function(e){var t=this,o=e.pixelRatio,r=e.margin,i=e.width,a=e.height,l=e.outerWidth,u=e.outerHeight,d=e.getColor,s=e.emptyColor,f=e.emptyOpacity,c=e.borderWidth,p=e.getBorderColor,v=e.cells,y=e.cellSize,g=e.origin,C=e.computedData,x=e.legendData,b=e.legends,R=e.theme;this.surface.width=l*o,this.surface.height=u*o,this.ctx.scale(o,o),this.ctx.fillStyle=R.background,this.ctx.fillRect(0,0,l,u),this.ctx.translate(r.left,r.top),v.forEach((function(e){e.color=s})),C.forEach((function(e){h.default(e.startAt,e.endAt).forEach((function(t){var o=v[t];void 0!==o&&(o.data=e,o.groupIndex=e.groupIndex,o.color=d(e))}))})),v.forEach((function(e){t.ctx.save(),t.ctx.globalAlpha=e.data?1:f,t.ctx.fillStyle=e.color,t.ctx.fillRect(e.x+g.x,e.y+g.y,y,y),c>0&&(t.ctx.strokeStyle=p(e),t.ctx.lineWidth=c,t.ctx.strokeRect(e.x+g.x,e.y+g.y,y,y)),t.ctx.restore()})),b.forEach((function(e){n.renderLegendToCanvas(t.ctx,m({},e,{data:x,containerWidth:i,containerHeight:a,theme:R}))}))},o.render=function(){var e=this,t=this.props,o=t.outerWidth,r=t.outerHeight,n=t.pixelRatio,a=t.isInteractive,l=t.theme;return u.jsx(i.LegacyContainer,{isInteractive:a,theme:l,animate:!1,children:function(t){var i=t.showTooltip,a=t.hideTooltip;return u.jsx("canvas",{ref:function(t){e.surface=t},width:o*n,height:r*n,style:{width:o,height:r},onMouseEnter:e.handleMouseHover(i,a),onMouseMove:e.handleMouseHover(i,a),onMouseLeave:e.handleMouseLeave(a),onClick:e.handleClick})}})},t}(e.Component);F.propTypes=W,F.displayName="WaffleCanvas";var _=r.setDisplayName(F.displayName)(A(F));exports.ResponsiveWaffle=function(e){return u.jsx(i.ResponsiveWrapper,{children:function(t){var o=t.width,r=t.height;return u.jsx(L,m({width:o,height:r},e))}})},exports.ResponsiveWaffleCanvas=function(e){return u.jsx(i.ResponsiveWrapper,{children:function(t){var o=t.width,r=t.height;return u.jsx(_,m({width:o,height:r},e))}})},exports.ResponsiveWaffleHtml=function(e){return u.jsx(i.ResponsiveWrapper,{children:function(t){var o=t.width,r=t.height;return u.jsx(z,m({width:o,height:r},e))}})},exports.Waffle=L,exports.WaffleCanvas=_,exports.WaffleCanvasDefaultProps=D,exports.WaffleCanvasPropTypes=W,exports.WaffleDefaultProps=k,exports.WaffleHtml=z,exports.WaffleHtmlDefaultProps=P,exports.WaffleHtmlPropTypes=w,exports.WafflePropTypes=q;
//# sourceMappingURL=nivo-waffle.cjs.js.map
